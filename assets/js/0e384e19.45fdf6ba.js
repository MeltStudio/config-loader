"use strict";(self.webpackChunk_meltstudio_config_loader=self.webpackChunk_meltstudio_config_loader||[]).push([[976],{2053(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"intro","title":"@meltstudio/config-loader","description":"A type-safe configuration loader for Node.js. Define your schema once, load from YAML or JSON files, .env files, environment variables, and CLI arguments \u2014 and get a fully typed result with zero manual type annotations.","source":"@site/docs/intro.md","sourceDirName":".","slug":"/","permalink":"/config-loader/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"slug":"/","title":"@meltstudio/config-loader"}}');var i=r(4848),t=r(8453);const o={slug:"/",title:"@meltstudio/config-loader"},a="@meltstudio/config-loader",l={},c=[{value:"Why config-loader?",id:"why-config-loader",level:2},{value:"Features",id:"features",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Schema API",id:"schema-api",level:2},{value:"Primitives",id:"primitives",level:3},{value:"Objects",id:"objects",level:3},{value:"Arrays",id:"arrays",level:3},{value:"Enum Constraints (<code>oneOf</code>)",id:"enum-constraints-oneof",level:2},{value:"Type Narrowing",id:"type-narrowing",level:3},{value:"Sensitive Fields",id:"sensitive-fields",level:2},{value:"<code>printConfig()</code> auto-masking",id:"printconfig-auto-masking",level:3},{value:"<code>maskSecrets()</code>",id:"masksecrets",level:3},{value:"Validation",id:"validation",level:2},{value:"With Zod",id:"with-zod",level:3},{value:"With a custom validator",id:"with-a-custom-validator",level:3},{value:"Loading Sources",id:"loading-sources",level:2},{value:"Extended Loading (Source Metadata)",id:"extended-loading-source-metadata",level:2},{value:"Debug Helper",id:"debug-helper",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Strict Mode",id:"strict-mode",level:3},{value:"TypeScript Utilities",id:"typescript-utilities",level:2},{value:"CLI Arguments",id:"cli-arguments",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"<code>.env</code> File Support",id:"env-file-support",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Load from YAML with env overrides",id:"load-from-yaml-with-env-overrides",level:3},{value:"Strict mode for production",id:"strict-mode-for-production",level:3},{value:"Catch and inspect errors",id:"catch-and-inspect-errors",level:3},{value:"Load from a directory of config files",id:"load-from-a-directory-of-config-files",level:3},{value:"Access source metadata with loadExtended",id:"access-source-metadata-with-loadextended",level:3},{value:"Combine .env files with process.env",id:"combine-env-files-with-processenv",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Forgetting <code>item</code> in <code>c.object()</code>",id:"forgetting-item-in-cobject",level:3},{value:"Setting <code>env</code> on an option but not enabling env loading",id:"setting-env-on-an-option-but-not-enabling-env-loading",level:3},{value:"Expecting <code>.env</code> files to work without <code>envFile</code>",id:"expecting-env-files-to-work-without-envfile",level:3},{value:"Not catching <code>ConfigLoadError</code>",id:"not-catching-configloaderror",level:3},{value:"Using <code>required: true</code> on nested fields without the parent object",id:"using-required-true-on-nested-fields-without-the-parent-object",level:3},{value:"License",id:"license",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"meltstudioconfig-loader",children:"@meltstudio/config-loader"})}),"\n",(0,i.jsxs)(n.p,{children:["A type-safe configuration loader for Node.js. Define your schema once, load from YAML or JSON files, ",(0,i.jsx)(n.code,{children:".env"})," files, environment variables, and CLI arguments \u2014 and get a fully typed result with zero manual type annotations."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Upgrading from v1?"})," v1.x is deprecated. v2 includes breaking changes to the public API, object schema syntax, and requires Node.js >= 20. Install the latest version with ",(0,i.jsx)(n.code,{children:"npm install @meltstudio/config-loader@latest"})," or ",(0,i.jsx)(n.code,{children:"yarn add @meltstudio/config-loader@latest"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"why-config-loader",children:"Why config-loader?"}),"\n",(0,i.jsxs)(n.p,{children:["Most config libraries give you ",(0,i.jsx)(n.code,{children:"Record<string, unknown>"})," and leave you to cast or validate manually. config-loader infers TypeScript types directly from your schema definition:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\n\nconst config = c\n  .schema({\n    port: c.number({ required: true, env: "PORT" }),\n    database: c.object({\n      item: {\n        host: c.string({ required: true }),\n        credentials: c.object({\n          item: {\n            username: c.string(),\n            password: c.string({ env: "DB_PASSWORD" }),\n          },\n        }),\n      },\n    }),\n    features: c.array({\n      required: true,\n      item: c.object({\n        item: {\n          name: c.string(),\n          enabled: c.bool(),\n        },\n      }),\n    }),\n  })\n  .load({\n    env: true,\n    args: true,\n    files: "./config.yaml",\n  });\n\n// config is fully typed:\n// {\n//   port: number;\n//   database: { host: string; credentials: { username: string; password: string } };\n//   features: { name: string; enabled: boolean }[];\n// }\n'})}),"\n",(0,i.jsxs)(n.p,{children:["No separate interface to maintain. No ",(0,i.jsx)(n.code,{children:"as"})," casts. The types flow from the schema."]}),"\n",(0,i.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Full type inference"})," \u2014 schema definition produces typed output automatically"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multiple sources"})," \u2014 YAML files, JSON files, ",(0,i.jsx)(n.code,{children:".env"})," files, environment variables, CLI arguments"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Priority resolution"})," \u2014 CLI > process.env > ",(0,i.jsx)(n.code,{children:".env"})," files > Config files > Defaults"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:".env"})," file support"]})," \u2014 load environment variables from ",(0,i.jsx)(n.code,{children:".env"})," files with automatic line tracking"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nested objects and arrays"})," \u2014 deeply nested configs with full type safety"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Structured errors"})," \u2014 typed ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})," with per-field error details and warnings"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enum constraints"})," \u2014 restrict values to a fixed set with ",(0,i.jsx)(n.code,{children:"oneOf"}),", with full type narrowing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sensitive fields"})," \u2014 mark fields with ",(0,i.jsx)(n.code,{children:"sensitive: true"})," to auto-mask in ",(0,i.jsx)(n.code,{children:"printConfig()"})," and ",(0,i.jsx)(n.code,{children:"maskSecrets()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Schema validation"})," \u2014 optional per-field validation via ",(0,i.jsx)(n.a,{href:"https://github.com/standard-schema/standard-schema",children:"Standard Schema"})," (Zod, Valibot, ArkType, or custom)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Strict mode"})," \u2014 promote warnings to errors for production safety"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Default values"})," \u2014 static or computed (via functions)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multiple files / directory loading"})," \u2014 load from a list of files or an entire directory"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node.js >= 20"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @meltstudio/config-loader\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn add @meltstudio/config-loader\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"config.yaml:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"version: 1.0.0\nwebsite:\n  title: My Website\n  description: A simple and elegant website\n  isProduction: false\n\ndatabase:\n  host: localhost\n  port: 5432\n  credentials:\n    username: admin\n    password: secret\n\nsocialMedia: [https://twitter.com/example, https://instagram.com/example]\n\nfeatures:\n  - name: Store\n    enabled: true\n  - name: Admin\n    enabled: false\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"index.ts:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import path from "path";\nimport c from "@meltstudio/config-loader";\n\nconst config = c\n  .schema({\n    version: c.string({ required: true, cli: true }),\n    website: c.object({\n      item: {\n        title: c.string({ required: true }),\n        url: c.string({\n          required: false,\n          defaultValue: "www.mywebsite.dev",\n        }),\n        description: c.string({ required: true }),\n        isProduction: c.bool({ required: true }),\n      },\n    }),\n    database: c.object({\n      item: {\n        host: c.string({ required: true }),\n        port: c.number({ required: true }),\n        credentials: c.object({\n          item: {\n            username: c.string(),\n            password: c.string(),\n          },\n        }),\n      },\n    }),\n    socialMedia: c.array({\n      required: true,\n      item: c.string({ required: true }),\n    }),\n    features: c.array({\n      required: true,\n      item: c.object({\n        item: {\n          name: c.string(),\n          enabled: c.bool(),\n        },\n      }),\n    }),\n  })\n  .load({\n    env: false,\n    args: true,\n    files: path.join(__dirname, "./config.yaml"),\n  });\n\nconsole.log(JSON.stringify(config, null, 2));\n'})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "version": "1.0.0",\n  "website": {\n    "title": "My Website",\n    "url": "www.mywebsite.dev",\n    "description": "A simple and elegant website",\n    "isProduction": false\n  },\n  "database": {\n    "host": "localhost",\n    "port": 5432,\n    "credentials": {\n      "username": "admin",\n      "password": "secret"\n    }\n  },\n  "socialMedia": [\n    "https://twitter.com/example",\n    "https://instagram.com/example"\n  ],\n  "features": [\n    { "name": "Store", "enabled": true },\n    { "name": "Admin", "enabled": false }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"schema-api",children:"Schema API"}),"\n",(0,i.jsx)(n.h3,{id:"primitives",children:"Primitives"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'c.string({\n  required: true,\n  env: "MY_VAR",\n  cli: true,\n  defaultValue: "fallback",\n});\nc.number({ required: true, env: "PORT" });\nc.bool({ env: "DEBUG", defaultValue: false });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"objects",children:"Objects"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"c.object()"})," to declare nested object schemas:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"c.object({\n  item: {\n    host: c.string(),\n    port: c.number(),\n  },\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"Objects can be nested arbitrarily deep:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'c.schema({\n  database: c.object({\n    item: {\n      host: c.string(),\n      port: c.number(),\n      credentials: c.object({\n        item: {\n          username: c.string(),\n          password: c.string({ env: "DB_PASSWORD" }),\n        },\n      }),\n    },\n  }),\n});\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"c.object()"})," accepts a ",(0,i.jsx)(n.code,{children:"required"})," option (defaults to ",(0,i.jsx)(n.code,{children:"false"}),"). When the entire subtree is absent from all sources, child ",(0,i.jsx)(n.code,{children:"required"})," options will trigger errors through normal validation."]}),"\n",(0,i.jsx)(n.h3,{id:"arrays",children:"Arrays"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"c.array({ required: true, item: c.string() }); // string[]\nc.array({ required: true, item: c.number() }); // number[]\nc.array({\n  item: c.object({\n    item: { name: c.string(), age: c.number() },\n  }),\n}); // { name: string; age: number }[]\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"enum-constraints-oneof",children:["Enum Constraints (",(0,i.jsx)(n.code,{children:"oneOf"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"oneOf"})," to restrict a field to a fixed set of allowed values. The check runs after type coercion and before any ",(0,i.jsx)(n.code,{children:"validate"})," schema:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    env: c.string({\n      env: "NODE_ENV",\n      defaultValue: "development",\n      oneOf: ["development", "staging", "production"],\n    }),\n    logLevel: c.number({\n      env: "LOG_LEVEL",\n      defaultValue: 1,\n      oneOf: [0, 1, 2, 3],\n    }),\n  })\n  .load({ env: true, args: false });\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If a value is not in the allowed set, a ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})," is thrown with ",(0,i.jsx)(n.code,{children:'kind: "validation"'}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"type-narrowing",children:"Type Narrowing"}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"oneOf"})," is provided, the inferred type is automatically narrowed to the union of the allowed values:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    env: c.string({ oneOf: ["dev", "staging", "prod"] }),\n  })\n  .load({ env: false, args: false });\n\n// config.env is typed as "dev" | "staging" | "prod", not string\n'})}),"\n",(0,i.jsxs)(n.p,{children:["When used with ",(0,i.jsx)(n.code,{children:"cli: true"}),", the ",(0,i.jsx)(n.code,{children:"--help"})," output automatically lists the allowed values."]}),"\n",(0,i.jsx)(n.h2,{id:"sensitive-fields",children:"Sensitive Fields"}),"\n",(0,i.jsxs)(n.p,{children:["Mark fields as ",(0,i.jsx)(n.code,{children:"sensitive: true"})," to prevent their values from being exposed in logs or debug output:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const schema = {\n  host: c.string({ defaultValue: "localhost" }),\n  apiKey: c.string({ env: "API_KEY", sensitive: true }),\n  db: c.object({\n    item: {\n      host: c.string({ defaultValue: "db.local" }),\n      password: c.string({ env: "DB_PASS", sensitive: true }),\n    },\n  }),\n};\n\nconst config = c.schema(schema).load({ env: true, args: false });\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Sensitive values load normally \u2014 ",(0,i.jsx)(n.code,{children:"config.apiKey"})," returns the real value. The flag only affects masking utilities."]}),"\n",(0,i.jsxs)(n.h3,{id:"printconfig-auto-masking",children:[(0,i.jsx)(n.code,{children:"printConfig()"})," auto-masking"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"printConfig()"})," automatically masks sensitive fields:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const result = c.schema(schema).loadExtended({ env: true, args: false });\nprintConfig(result);\n// apiKey shows "***" instead of the real value\n// db.password shows "***" instead of the real value\n'})}),"\n",(0,i.jsx)(n.h3,{id:"masksecrets",children:(0,i.jsx)(n.code,{children:"maskSecrets()"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"maskSecrets()"})," to create a safe-to-log copy of your config:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c, { maskSecrets } from "@meltstudio/config-loader";\n\n// With a plain config from load()\nconst config = c.schema(schema).load({ env: true, args: false });\nconsole.log(maskSecrets(config, schema));\n// { host: "localhost", apiKey: "***", db: { host: "db.local", password: "***" } }\n\n// With an extended result from loadExtended()\nconst result = c.schema(schema).loadExtended({ env: true, args: false });\nconst masked = maskSecrets(result);\n// masked.data contains ConfigNodes with "***" for sensitive values\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The original config object is never mutated \u2014 ",(0,i.jsx)(n.code,{children:"maskSecrets()"})," always returns a new copy."]}),"\n",(0,i.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,i.jsxs)(n.p,{children:["Add per-field validation using the ",(0,i.jsx)(n.code,{children:"validate"})," option. config-loader accepts any ",(0,i.jsx)(n.a,{href:"https://github.com/standard-schema/standard-schema",children:"Standard Schema v1"})," implementation \u2014 including ",(0,i.jsx)(n.strong,{children:"Zod"}),", ",(0,i.jsx)(n.strong,{children:"Valibot"}),", and ",(0,i.jsx)(n.strong,{children:"ArkType"})," \u2014 or a custom validator."]}),"\n",(0,i.jsxs)(n.p,{children:["Validation runs ",(0,i.jsx)(n.strong,{children:"after"})," type coercion, so validators see the final typed value (e.g., the number ",(0,i.jsx)(n.code,{children:"3000"}),", not the string ",(0,i.jsx)(n.code,{children:'"3000"'})," from an env var)."]}),"\n",(0,i.jsx)(n.h3,{id:"with-zod",children:"With Zod"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\nimport { z } from "zod";\n\nconst config = c\n  .schema({\n    port: c.number({\n      required: true,\n      env: "PORT",\n      validate: z.number().min(1).max(65535),\n    }),\n    host: c.string({\n      required: true,\n      validate: z.string().url(),\n    }),\n    env: c.string({\n      defaultValue: "development",\n      validate: z.enum(["development", "staging", "production"]),\n    }),\n  })\n  .load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"with-a-custom-validator",children:"With a custom validator"}),"\n",(0,i.jsxs)(n.p,{children:["Any object with a ",(0,i.jsx)(n.code,{children:"~standard.validate()"})," method works:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const portValidator = {\n  "~standard": {\n    version: 1,\n    vendor: "my-app",\n    validate(value: unknown) {\n      if (typeof value === "number" && value >= 1 && value <= 65535) {\n        return { value };\n      }\n      return { issues: [{ message: "must be a valid port (1-65535)" }] };\n    },\n  },\n};\n\nc.number({ required: true, env: "PORT", validate: portValidator });\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Validation errors are collected alongside other config errors and thrown as ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})," with ",(0,i.jsx)(n.code,{children:'kind: "validation"'}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'try {\n  const config = c.schema({ ... }).load({ ... });\n} catch (err) {\n  if (err instanceof ConfigLoadError) {\n    for (const entry of err.errors) {\n      if (entry.kind === "validation") {\n        console.error(`Validation: ${entry.path} \u2014 ${entry.message}`);\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"loading-sources",children:"Loading Sources"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,          // Read from process.env\n  args: true,         // Read from CLI arguments (--database.port 3000)\n  files: "./config.yaml",                    // Single YAML file\n  files: "./config.json",                    // Single JSON file\n  files: ["./base.yaml", "./overrides.json"], // Mix YAML and JSON (first takes priority)\n  dir: "./config.d/",                        // All files in a directory (sorted)\n  envFile: "./.env",                         // Single .env file\n  envFile: ["./.env", "./.env.local"],       // Multiple .env files (later overrides earlier)\n  defaults: { port: 3000 },                  // Programmatic defaults\n})\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Both YAML (",(0,i.jsx)(n.code,{children:".yaml"}),", ",(0,i.jsx)(n.code,{children:".yml"}),") and JSON (",(0,i.jsx)(n.code,{children:".json"}),") files are supported. The format is detected automatically from the file extension."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Priority order:"})," CLI arguments > ",(0,i.jsx)(n.code,{children:"process.env"})," > ",(0,i.jsx)(n.code,{children:".env"})," files > Config files > Defaults"]}),"\n",(0,i.jsx)(n.h2,{id:"extended-loading-source-metadata",children:"Extended Loading (Source Metadata)"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"loadExtended()"})," instead of ",(0,i.jsx)(n.code,{children:"load()"})," to get each value wrapped in a ",(0,i.jsx)(n.code,{children:"ConfigNode"})," that includes source metadata \u2014 where the value came from, which file, environment variable, or CLI argument provided it."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\n\nconst { data, warnings } = c\n  .schema({\n    port: c.number({ required: true, env: "PORT" }),\n    host: c.string({ defaultValue: "localhost" }),\n  })\n  .loadExtended({\n    env: true,\n    args: false,\n    files: "./config.yaml",\n  });\n\n// `warnings` is a string[] of non-fatal issues (e.g. type coercions, unused env mappings)\nif (warnings.length > 0) {\n  warnings.forEach((w) => console.warn(w));\n}\n\n// Each leaf in `data` is a ConfigNode with:\n// {\n//   value: 3000,\n//   path: "port",\n//   sourceType: "env" | "envFile" | "file" | "args" | "default",\n//   file: "./config.yaml" | "./.env" | null,\n//   variableName: "PORT" | null,\n//   argName: null,\n//   line: 5 | null,      // source line (1-based) for YAML, JSON, and .env files; null for env/args/default\n//   column: 3 | null      // source column (1-based) for YAML, JSON, and .env files; null for env/args/default\n// }\nconsole.log(data.port.value); // 3000\nconsole.log(data.port.sourceType); // "env"\nconsole.log(data.port.variableName); // "PORT"\n'})}),"\n",(0,i.jsx)(n.p,{children:"This is useful for debugging configuration resolution, building admin UIs that show where each setting originated, or auditing which sources are active."}),"\n",(0,i.jsx)(n.h3,{id:"debug-helper",children:"Debug Helper"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"printConfig()"})," to format the result of ",(0,i.jsx)(n.code,{children:"loadExtended()"})," as a readable table:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c, { printConfig } from "@meltstudio/config-loader";\n\nconst result = c\n  .schema({\n    host: c.string({ defaultValue: "localhost" }),\n    port: c.number({ env: "PORT" }),\n    debug: c.bool({ cli: true }),\n  })\n  .loadExtended({ env: true, args: true, files: "./config.yaml" });\n\nprintConfig(result);\n'})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Path  \u2502 Value     \u2502 Source  \u2502 Detail         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 host  \u2502 localhost \u2502 default \u2502                \u2502\n\u2502 port  \u2502 8080      \u2502 env     \u2502 PORT           \u2502\n\u2502 debug \u2502 true      \u2502 args    \u2502 --debug        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.p,{children:"Options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"printConfig(result, { silent: true })"})," \u2014 returns the string without printing to console"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"printConfig(result, { maxValueLength: 30 })"})," \u2014 truncate long values (default: 50)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsxs)(n.p,{children:["When validation fails, config-loader throws a ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})," with structured error details:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c, { ConfigLoadError } from "@meltstudio/config-loader";\n\ntry {\n  const config = c.schema({ port: c.number({ required: true }) }).load({\n    env: false,\n    args: false,\n    files: "./config.yaml",\n  });\n} catch (err) {\n  if (err instanceof ConfigLoadError) {\n    for (const entry of err.errors) {\n      console.error(`[${entry.kind}] ${entry.message}`);\n      // e.g. [required] Required option \'port\' not provided.\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Warnings (non-fatal issues like type coercions) are never printed to the console. Use ",(0,i.jsx)(n.code,{children:"loadExtended()"})," to access them, or they are included in ",(0,i.jsx)(n.code,{children:"ConfigLoadError.warnings"})," when errors occur."]}),"\n",(0,i.jsx)(n.h3,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,i.jsxs)(n.p,{children:["Enable ",(0,i.jsx)(n.code,{children:"strict: true"})," to promote all warnings to errors, causing ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})," to be thrown for any ambiguous or lossy configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,\n  args: false,\n  files: "./config.yaml",\n  strict: true,\n})\n'})}),"\n",(0,i.jsx)(n.p,{children:"This is useful in production environments where you want to catch type coercions, null values, and other ambiguous config early rather than silently accepting them."}),"\n",(0,i.jsx)(n.h2,{id:"typescript-utilities",children:"TypeScript Utilities"}),"\n",(0,i.jsx)(n.p,{children:"config-loader exports several types for advanced use cases:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c, {\n  type SchemaValue, // Infer the resolved config type from a schema\n  type SettingsSources, // Type for the sources object passed to load()\n  type ExtendedResult, // Return type of loadExtended()\n  type NodeTree, // Tree of ConfigNode objects (ExtendedResult.data)\n  ConfigNode, // Class representing a resolved value with source metadata\n  ConfigNodeArray, // Class representing an array of ConfigNode values\n  type RecursivePartial, // Deep partial utility used by the defaults option\n  type StandardSchemaV1, // Standard Schema v1 interface for validators\n  maskSecrets, // Create a safe-to-log copy with sensitive values masked\n  printConfig, // Format loadExtended() result as a readable table\n} from "@meltstudio/config-loader";\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The most commonly needed is ",(0,i.jsx)(n.code,{children:"SchemaValue"}),", which infers the plain TypeScript type from a schema:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const mySchema = {\n  port: c.number({ env: "PORT" }),\n  db: c.object({ item: { host: c.string(), port: c.number() } }),\n};\n\ntype MyConfig = SchemaValue<typeof mySchema>;\n// { port: number; db: { host: string; port: number } }\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cli-arguments",children:"CLI Arguments"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"cli: true"})," on an option to allow overriding via command line:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"c.schema({\n  version: c.string({ required: true, cli: true }),\n});\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node app.js --version 2.0.0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:'env: "VAR_NAME"'})," on an option and ",(0,i.jsx)(n.code,{children:"env: true"})," in the load options:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'c.schema({\n  database: c.object({\n    item: {\n      password: c.string({ env: "DB_PASSWORD" }),\n    },\n  }),\n}).load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"env-file-support",children:[(0,i.jsx)(n.code,{children:".env"})," File Support"]}),"\n",(0,i.jsxs)(n.p,{children:["Load environment variables from ",(0,i.jsx)(n.code,{children:".env"})," files using the ",(0,i.jsx)(n.code,{children:"envFile"})," option. Options with an ",(0,i.jsx)(n.code,{children:"env"})," mapping automatically pick up values from ",(0,i.jsx)(n.code,{children:".env"})," files \u2014 no new syntax needed on individual fields."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:".env:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DB_HOST=localhost\nDB_PORT=5432\nDB_PASSWORD=\"s3cret\"\nAPP_NAME='My App'\n# This is a comment\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    host: c.string({ env: "DB_HOST" }),\n    port: c.number({ env: "DB_PORT" }),\n    password: c.string({ env: "DB_PASSWORD" }),\n  })\n  .load({\n    env: true,\n    args: false,\n    envFile: "./.env",\n  });\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"process.env"})," always takes precedence over ",(0,i.jsx)(n.code,{children:".env"})," file values. This means you can use ",(0,i.jsx)(n.code,{children:".env"})," files for development defaults while overriding them in production via real environment variables."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Multiple ",(0,i.jsx)(n.code,{children:".env"})," files:"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,\n  args: false,\n  envFile: ["./.env", "./.env.local"],  // .env.local overrides .env\n})\n'})}),"\n",(0,i.jsx)(n.p,{children:"When using multiple files, later files override earlier ones for the same key."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:".env"})," parser supports:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"KEY=VALUE"})," pairs (whitespace trimmed)"]}),"\n",(0,i.jsxs)(n.li,{children:["Comments (lines starting with ",(0,i.jsx)(n.code,{children:"#"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Quoted values (double ",(0,i.jsx)(n.code,{children:'"..."'})," or single ",(0,i.jsx)(n.code,{children:"'...'"})," quotes stripped)"]}),"\n",(0,i.jsxs)(n.li,{children:["Empty values (",(0,i.jsx)(n.code,{children:"KEY="}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When using ",(0,i.jsx)(n.code,{children:"loadExtended()"}),", values from ",(0,i.jsx)(n.code,{children:".env"})," files have ",(0,i.jsx)(n.code,{children:'sourceType: "envFile"'})," with ",(0,i.jsx)(n.code,{children:"file"}),", ",(0,i.jsx)(n.code,{children:"line"}),", and ",(0,i.jsx)(n.code,{children:"column"})," metadata pointing to the ",(0,i.jsx)(n.code,{children:".env"})," file location."]}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"load-from-yaml-with-env-overrides",children:"Load from YAML with env overrides"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\n\nconst config = c\n  .schema({\n    port: c.number({ required: true, env: "PORT", defaultValue: 3000 }),\n    host: c.string({ required: true, env: "HOST", defaultValue: "localhost" }),\n  })\n  .load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"strict-mode-for-production",children:"Strict mode for production"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    port: c.number({ required: true, env: "PORT" }),\n    dbUrl: c.string({ required: true, env: "DATABASE_URL" }),\n  })\n  .load({\n    env: true,\n    args: false,\n    files: "./config.yaml",\n    strict: true, // any type coercion or ambiguity throws an error\n  });\n'})}),"\n",(0,i.jsx)(n.h3,{id:"catch-and-inspect-errors",children:"Catch and inspect errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import c, { ConfigLoadError } from "@meltstudio/config-loader";\n\ntry {\n  const config = c\n    .schema({ port: c.number({ required: true }) })\n    .load({ env: false, args: false, files: "./config.yaml" });\n} catch (err) {\n  if (err instanceof ConfigLoadError) {\n    for (const entry of err.errors) {\n      console.error(`[${entry.kind}] ${entry.path}: ${entry.message}`);\n    }\n    // err.warnings contains non-fatal issues\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"load-from-a-directory-of-config-files",children:"Load from a directory of config files"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    port: c.number({ required: true }),\n    host: c.string({ required: true }),\n  })\n  .load({ env: false, args: false, dir: "./config.d/" });\n// All YAML/JSON files in the directory are loaded and merged (sorted by filename)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"access-source-metadata-with-loadextended",children:"Access source metadata with loadExtended"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const { data, warnings } = c\n  .schema({\n    port: c.number({ required: true, env: "PORT" }),\n  })\n  .loadExtended({ env: true, args: false, files: "./config.yaml" });\n\nconst portNode = data.port; // ConfigNode\nconsole.log(portNode.value); // 3000\nconsole.log(portNode.sourceType); // "env" | "file" | "default" | "args" | "envFile"\nconsole.log(portNode.file); // "./config.yaml" or null\nconsole.log(portNode.line); // source line number or null\n'})}),"\n",(0,i.jsx)(n.h3,{id:"combine-env-files-with-processenv",children:"Combine .env files with process.env"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    apiKey: c.string({ required: true, env: "API_KEY" }),\n    debug: c.bool({ env: "DEBUG", defaultValue: false }),\n  })\n  .load({\n    env: true, // reads process.env\n    args: false,\n    envFile: ["./.env", "./.env.local"], // .env.local overrides .env\n  });\n// Priority: process.env > .env.local > .env > defaults\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,i.jsxs)(n.h3,{id:"forgetting-item-in-cobject",children:["Forgetting ",(0,i.jsx)(n.code,{children:"item"})," in ",(0,i.jsx)(n.code,{children:"c.object()"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// WRONG \u2014 fields are passed directly\nc.object({ host: c.string(), port: c.number() });\n\n// CORRECT \u2014 fields must be inside `item`\nc.object({ item: { host: c.string(), port: c.number() } });\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"setting-env-on-an-option-but-not-enabling-env-loading",children:["Setting ",(0,i.jsx)(n.code,{children:"env"})," on an option but not enabling env loading"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// WRONG \u2014 env: "PORT" is set but env loading is disabled\nc.schema({ port: c.number({ env: "PORT" }) }).load({\n  env: false,\n  args: false,\n  files: "./config.yaml",\n});\n// This emits a warning: "Options [port] have env mappings but env loading is disabled"\n\n// CORRECT \u2014 set env: true in load options\nc.schema({ port: c.number({ env: "PORT" }) }).load({\n  env: true,\n  args: false,\n  files: "./config.yaml",\n});\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"expecting-env-files-to-work-without-envfile",children:["Expecting ",(0,i.jsx)(n.code,{children:".env"})," files to work without ",(0,i.jsx)(n.code,{children:"envFile"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// WRONG \u2014 .env files are not loaded by default\nc.schema({ key: c.string({ env: "API_KEY" }) }).load({\n  env: true,\n  args: false,\n});\n// This only reads process.env, not .env files\n\n// CORRECT \u2014 explicitly pass envFile\nc.schema({ key: c.string({ env: "API_KEY" }) }).load({\n  env: true,\n  args: false,\n  envFile: "./.env",\n});\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"not-catching-configloaderror",children:["Not catching ",(0,i.jsx)(n.code,{children:"ConfigLoadError"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// WRONG \u2014 unhandled error crashes the process with an unhelpful stack trace\nconst config = c\n  .schema({ port: c.number({ required: true }) })\n  .load({ env: false, args: false });\n\n// CORRECT \u2014 catch and handle structured errors\ntry {\n  const config = c\n    .schema({ port: c.number({ required: true }) })\n    .load({ env: false, args: false });\n} catch (err) {\n  if (err instanceof ConfigLoadError) {\n    console.error(err.errors); // structured error details\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"using-required-true-on-nested-fields-without-the-parent-object",children:["Using ",(0,i.jsx)(n.code,{children:"required: true"})," on nested fields without the parent object"]}),"\n",(0,i.jsxs)(n.p,{children:["If the parent object is entirely absent from all sources, child ",(0,i.jsx)(n.code,{children:"required"})," fields will still trigger errors. Use ",(0,i.jsx)(n.code,{children:"required"})," on the parent ",(0,i.jsx)(n.code,{children:"c.object()"})," only if the entire subtree must be present."]}),"\n",(0,i.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,i.jsxs)(n.p,{children:["This package is licensed under the MIT License. See the ",(0,i.jsx)(n.a,{href:"https://github.com/MeltStudio/config-loader/blob/main/LICENSE",children:"LICENSE"})," file for details."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);