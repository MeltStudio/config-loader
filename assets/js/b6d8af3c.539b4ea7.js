"use strict";(self.webpackChunk_meltstudio_config_loader=self.webpackChunk_meltstudio_config_loader||[]).push([[452],{8982(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"loading-and-sources","title":"Loading & Sources","description":"Loading Config","source":"@site/docs/loading-and-sources.md","sourceDirName":".","slug":"/loading-and-sources","permalink":"/config-loader/loading-and-sources","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Loading & Sources"},"sidebar":"defaultSidebar","previous":{"title":"Schema API","permalink":"/config-loader/schema-api"},"next":{"title":"TypeScript Utilities","permalink":"/config-loader/typescript-utilities"}}');var r=i(4848),o=i(8453);const l={sidebar_position:3,title:"Loading & Sources"},a="Loading & Sources",t={},c=[{value:"Loading Config",id:"loading-config",level:2},{value:"Source Options",id:"source-options",level:3},{value:"Priority Order",id:"priority-order",level:3},{value:"Config Files",id:"config-files",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"<code>.env</code> File Support",id:"env-file-support",level:2},{value:"CLI Arguments",id:"cli-arguments",level:2},{value:"Extended Loading (Source Metadata)",id:"extended-loading-source-metadata",level:2},{value:"<code>printConfig</code>",id:"printconfig",level:2},{value:"<code>maskSecrets</code>",id:"masksecrets",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Strict Mode",id:"strict-mode",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"loading--sources",children:"Loading & Sources"})}),"\n",(0,r.jsx)(n.h2,{id:"loading-config",children:"Loading Config"}),"\n",(0,r.jsxs)(n.p,{children:["Call ",(0,r.jsx)(n.code,{children:".load()"})," on a schema to resolve all values and return a plain typed object:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    port: c.number({ required: true, env: "PORT", defaultValue: 3000 }),\n    host: c.string({ required: true, env: "HOST", defaultValue: "localhost" }),\n  })\n  .load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,r.jsx)(n.h3,{id:"source-options",children:"Source Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,          // Read from process.env\n  args: true,         // Read from CLI arguments (--database.port 3000)\n  files: "./config.yaml",                    // Single YAML file\n  files: "./config.json",                    // Single JSON file\n  files: "./config.toml",                    // Single TOML file\n  files: ["./base.yaml", "./overrides.json"], // Mix formats (first takes priority)\n  dir: "./config.d/",                        // All files in a directory (sorted)\n  envFile: "./.env",                         // Single .env file\n  envFile: ["./.env", "./.env.local"],       // Multiple .env files (later overrides earlier)\n  defaults: { port: 3000 },                  // Programmatic defaults\n})\n'})}),"\n",(0,r.jsxs)(n.p,{children:["YAML (",(0,r.jsx)(n.code,{children:".yaml"}),", ",(0,r.jsx)(n.code,{children:".yml"}),"), JSON (",(0,r.jsx)(n.code,{children:".json"}),"), and TOML (",(0,r.jsx)(n.code,{children:".toml"}),") files are supported. The format is detected automatically from the file extension."]}),"\n",(0,r.jsx)(n.h3,{id:"priority-order",children:"Priority Order"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["CLI arguments > ",(0,r.jsx)(n.code,{children:"process.env"})," > ",(0,r.jsx)(n.code,{children:".env"})," files > Config files > Defaults"]})}),"\n",(0,r.jsx)(n.h2,{id:"config-files",children:"Config Files"}),"\n",(0,r.jsx)(n.p,{children:"Load from one or more YAML/JSON/TOML files, or from an entire directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Single file\n.load({ env: false, args: false, files: "./config.yaml" })\n\n// Multiple files (first takes priority)\n.load({ env: false, args: false, files: ["./base.yaml", "./overrides.yaml"] })\n\n// All files in a directory (sorted by filename)\n.load({ env: false, args: false, dir: "./config.d/" })\n'})}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:'env: "VAR_NAME"'})," on an option and ",(0,r.jsx)(n.code,{children:"env: true"})," in the load options:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'c.schema({\n  database: c.object({\n    item: {\n      password: c.string({ env: "DB_PASSWORD" }),\n    },\n  }),\n}).load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you set ",(0,r.jsx)(n.code,{children:'env: "PORT"'})," on a field but load with ",(0,r.jsx)(n.code,{children:"env: false"}),", config-loader emits a warning: ",(0,r.jsx)(n.em,{children:'"Options [port] have env mappings but env loading is disabled"'}),". Make sure to set ",(0,r.jsx)(n.code,{children:"env: true"})," when using env mappings."]})}),"\n",(0,r.jsxs)(n.h2,{id:"env-file-support",children:[(0,r.jsx)(n.code,{children:".env"})," File Support"]}),"\n",(0,r.jsxs)(n.p,{children:["Load environment variables from ",(0,r.jsx)(n.code,{children:".env"})," files using the ",(0,r.jsx)(n.code,{children:"envFile"})," option. Options with an ",(0,r.jsx)(n.code,{children:"env"})," mapping automatically pick up values from ",(0,r.jsx)(n.code,{children:".env"})," files \u2014 no new syntax needed on individual fields."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:".env:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DB_HOST=localhost\nDB_PORT=5432\nDB_PASSWORD=\"s3cret\"\nAPP_NAME='My App'\n# This is a comment\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    host: c.string({ env: "DB_HOST" }),\n    port: c.number({ env: "DB_PORT" }),\n    password: c.string({ env: "DB_PASSWORD" }),\n  })\n  .load({\n    env: true,\n    args: false,\n    envFile: "./.env",\n  });\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"process.env"})," always takes precedence over ",(0,r.jsx)(n.code,{children:".env"})," file values. This means you can use ",(0,r.jsx)(n.code,{children:".env"})," files for development defaults while overriding them in production via real environment variables."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Multiple ",(0,r.jsx)(n.code,{children:".env"})," files:"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,\n  args: false,\n  envFile: ["./.env", "./.env.local"],  // .env.local overrides .env\n})\n'})}),"\n",(0,r.jsx)(n.p,{children:"When using multiple files, later files override earlier ones for the same key."}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:".env"})," parser supports:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"KEY=VALUE"})," pairs (whitespace trimmed)"]}),"\n",(0,r.jsxs)(n.li,{children:["Comments (lines starting with ",(0,r.jsx)(n.code,{children:"#"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Quoted values (double ",(0,r.jsx)(n.code,{children:'"..."'})," or single ",(0,r.jsx)(n.code,{children:"'...'"})," quotes stripped)"]}),"\n",(0,r.jsxs)(n.li,{children:["Empty values (",(0,r.jsx)(n.code,{children:"KEY="}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:".env"})," files are ",(0,r.jsx)(n.strong,{children:"not"})," loaded by default. You must explicitly pass ",(0,r.jsx)(n.code,{children:"envFile"})," in the load options \u2014 setting ",(0,r.jsx)(n.code,{children:"env: true"})," alone only reads ",(0,r.jsx)(n.code,{children:"process.env"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"cli-arguments",children:"CLI Arguments"}),"\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:"cli: true"})," on an option to allow overriding via command line:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"c.schema({\n  version: c.string({ required: true, cli: true }),\n});\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node app.js --version 2.0.0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"extended-loading-source-metadata",children:"Extended Loading (Source Metadata)"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"loadExtended()"})," instead of ",(0,r.jsx)(n.code,{children:"load()"})," to get each value wrapped in a ",(0,r.jsx)(n.code,{children:"ConfigNode"})," that includes source metadata \u2014 where the value came from, which file, environment variable, or CLI argument provided it."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\n\nconst { data, warnings } = c\n  .schema({\n    port: c.number({ required: true, env: "PORT" }),\n    host: c.string({ defaultValue: "localhost" }),\n  })\n  .loadExtended({\n    env: true,\n    args: false,\n    files: "./config.yaml",\n  });\n\n// `warnings` is a string[] of non-fatal issues (e.g. type coercions, unused env mappings)\nif (warnings.length > 0) {\n  warnings.forEach((w) => console.warn(w));\n}\n\n// Each leaf in `data` is a ConfigNode with:\n// {\n//   value: 3000,\n//   path: "port",\n//   sourceType: "env" | "envFile" | "file" | "args" | "default",\n//   file: "./config.yaml" | "./.env" | null,\n//   variableName: "PORT" | null,\n//   argName: null,\n//   line: 5 | null,      // source line (1-based) for YAML, JSON, TOML, and .env files\n//   column: 3 | null      // source column (1-based) for YAML, JSON, TOML, and .env files\n// }\nconsole.log(data.port.value); // 3000\nconsole.log(data.port.sourceType); // "env"\nconsole.log(data.port.variableName); // "PORT"\n'})}),"\n",(0,r.jsx)(n.p,{children:"This is useful for debugging configuration resolution, building admin UIs that show where each setting originated, or auditing which sources are active."}),"\n",(0,r.jsx)(n.h2,{id:"printconfig",children:(0,r.jsx)(n.code,{children:"printConfig"})}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"printConfig()"})," to format the result of ",(0,r.jsx)(n.code,{children:"loadExtended()"})," as a readable table. Fields marked with ",(0,r.jsx)(n.a,{href:"./schema-api#sensitive-fields",children:(0,r.jsx)(n.code,{children:"sensitive: true"})})," are automatically masked."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import c, { printConfig } from "@meltstudio/config-loader";\n\nconst result = c\n  .schema({\n    host: c.string({ defaultValue: "localhost" }),\n    port: c.number({ env: "PORT" }),\n    apiKey: c.string({ env: "API_KEY", sensitive: true }),\n  })\n  .loadExtended({ env: true, args: true, files: "./config.yaml" });\n\nprintConfig(result);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Path   \u2502 Value     \u2502 Source  \u2502 Detail         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 host   \u2502 localhost \u2502 default \u2502                \u2502\n\u2502 port   \u2502 8080      \u2502 env     \u2502 PORT           \u2502\n\u2502 apiKey \u2502 ***       \u2502 env     \u2502 API_KEY        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.p,{children:"Options:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"printConfig(result, { silent: true })"})," \u2014 returns the string without printing to console"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"printConfig(result, { maxValueLength: 30 })"})," \u2014 truncate long values (default: 50)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"masksecrets",children:(0,r.jsx)(n.code,{children:"maskSecrets"})}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"maskSecrets()"})," to create a safe-to-log copy of your config with ",(0,r.jsx)(n.a,{href:"./schema-api#sensitive-fields",children:(0,r.jsx)(n.code,{children:"sensitive"})})," values replaced by ",(0,r.jsx)(n.code,{children:'"***"'}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import c, { maskSecrets } from "@meltstudio/config-loader";\n\nconst schema = {\n  host: c.string({ defaultValue: "localhost" }),\n  apiKey: c.string({ env: "API_KEY", sensitive: true }),\n};\n\n// With a plain config from load()\nconst config = c.schema(schema).load({ env: true, args: false });\nconsole.log(maskSecrets(config, schema));\n// { host: "localhost", apiKey: "***" }\n\n// With an extended result from loadExtended()\nconst result = c.schema(schema).loadExtended({ env: true, args: false });\nconst masked = maskSecrets(result);\n// masked.data contains ConfigNodes with "***" for sensitive values\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The original config object is never mutated \u2014 ",(0,r.jsx)(n.code,{children:"maskSecrets()"})," always returns a new copy."]}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsxs)(n.p,{children:["When validation fails, config-loader throws a ",(0,r.jsx)(n.code,{children:"ConfigLoadError"})," with structured error details:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import c, { ConfigLoadError } from "@meltstudio/config-loader";\n\ntry {\n  const config = c.schema({ port: c.number({ required: true }) }).load({\n    env: false,\n    args: false,\n    files: "./config.yaml",\n  });\n} catch (err) {\n  if (err instanceof ConfigLoadError) {\n    for (const entry of err.errors) {\n      console.error(`[${entry.kind}] ${entry.message}`);\n      // e.g. [required] Required option \'port\' not provided.\n    }\n    // err.warnings contains non-fatal issues\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Warnings (non-fatal issues like type coercions) are never printed to the console. Use ",(0,r.jsx)(n.code,{children:"loadExtended()"})," to access them, or they are included in ",(0,r.jsx)(n.code,{children:"ConfigLoadError.warnings"})," when errors occur."]}),"\n",(0,r.jsx)(n.h2,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,r.jsxs)(n.p,{children:["Enable ",(0,r.jsx)(n.code,{children:"strict: true"})," to promote all warnings to errors, causing ",(0,r.jsx)(n.code,{children:"ConfigLoadError"})," to be thrown for any ambiguous or lossy configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'.load({\n  env: true,\n  args: false,\n  files: "./config.yaml",\n  strict: true,\n})\n'})}),"\n",(0,r.jsx)(n.p,{children:"This is useful in production environments where you want to catch type coercions, null values, and other ambiguous config early rather than silently accepting them."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var s=i(6540);const r={},o=s.createContext(r);function l(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);