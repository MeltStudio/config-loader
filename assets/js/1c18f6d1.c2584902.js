"use strict";(self.webpackChunk_meltstudio_config_loader=self.webpackChunk_meltstudio_config_loader||[]).push([[437],{9792(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"schema-api","title":"Schema API","description":"Define your configuration shape using factory functions. Each field accepts options like required, env, cli, defaultValue, sensitive, oneOf, and validate.","source":"@site/docs/schema-api.md","sourceDirName":".","slug":"/schema-api","permalink":"/config-loader/schema-api","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Schema API"},"sidebar":"defaultSidebar","previous":{"title":"Getting Started","permalink":"/config-loader/"},"next":{"title":"Loading & Sources","permalink":"/config-loader/loading-and-sources"}}');var t=i(2615),r=i(416);const a={sidebar_position:2,title:"Schema API"},c="Schema API",o={},d=[{value:"Primitives",id:"primitives",level:2},{value:"Objects",id:"objects",level:2},{value:"Arrays",id:"arrays",level:2},{value:"Enum Constraints (<code>oneOf</code>)",id:"enum-constraints-oneof",level:2},{value:"Type Narrowing",id:"type-narrowing",level:3},{value:"Sensitive Fields",id:"sensitive-fields",level:2},{value:"Validation",id:"validation",level:2},{value:"With Zod",id:"with-zod",level:3},{value:"With a custom validator",id:"with-a-custom-validator",level:3},{value:"Validation pipeline",id:"validation-pipeline",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"schema-api",children:"Schema API"})}),"\n",(0,t.jsxs)(n.p,{children:["Define your configuration shape using factory functions. Each field accepts options like ",(0,t.jsx)(n.code,{children:"required"}),", ",(0,t.jsx)(n.code,{children:"env"}),", ",(0,t.jsx)(n.code,{children:"cli"}),", ",(0,t.jsx)(n.code,{children:"defaultValue"}),", ",(0,t.jsx)(n.code,{children:"sensitive"}),", ",(0,t.jsx)(n.code,{children:"oneOf"}),", and ",(0,t.jsx)(n.code,{children:"validate"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"primitives",children:"Primitives"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'c.string({\n  required: true,\n  env: "MY_VAR",\n  cli: true,\n  defaultValue: "fallback",\n});\nc.number({ required: true, env: "PORT" });\nc.bool({ env: "DEBUG", defaultValue: false });\n'})}),"\n",(0,t.jsx)(n.p,{children:"All factory functions can be called with no arguments for optional fields with no special behavior:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"c.string(); // optional string, no env/cli mapping\nc.number(); // optional number\nc.bool(); // optional boolean\n"})}),"\n",(0,t.jsx)(n.h2,{id:"objects",children:"Objects"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"c.object()"})," to declare nested object schemas. Fields must be inside the ",(0,t.jsx)(n.code,{children:"item"})," property:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"c.object({\n  item: {\n    host: c.string(),\n    port: c.number(),\n  },\n});\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["A common mistake is passing fields directly to ",(0,t.jsx)(n.code,{children:"c.object()"})," instead of wrapping them in ",(0,t.jsx)(n.code,{children:"item"}),":"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// WRONG \u2014 fields are passed directly\nc.object({ host: c.string(), port: c.number() });\n\n// CORRECT \u2014 fields must be inside `item`\nc.object({ item: { host: c.string(), port: c.number() } });\n"})})]}),"\n",(0,t.jsx)(n.p,{children:"Objects can be nested arbitrarily deep:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'c.schema({\n  database: c.object({\n    item: {\n      host: c.string(),\n      port: c.number(),\n      credentials: c.object({\n        item: {\n          username: c.string(),\n          password: c.string({ env: "DB_PASSWORD" }),\n        },\n      }),\n    },\n  }),\n});\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"c.object()"})," accepts a ",(0,t.jsx)(n.code,{children:"required"})," option (defaults to ",(0,t.jsx)(n.code,{children:"false"}),"). When the entire subtree is absent from all sources, child ",(0,t.jsx)(n.code,{children:"required"})," options will trigger errors through normal validation."]}),"\n",(0,t.jsx)(n.h2,{id:"arrays",children:"Arrays"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"c.array({ required: true, item: c.string() }); // string[]\nc.array({ required: true, item: c.number() }); // number[]\nc.array({\n  item: c.object({\n    item: { name: c.string(), age: c.number() },\n  }),\n}); // { name: string; age: number }[]\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"enum-constraints-oneof",children:["Enum Constraints (",(0,t.jsx)(n.code,{children:"oneOf"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"oneOf"})," to restrict a field to a fixed set of allowed values. The check runs after type coercion and before any ",(0,t.jsx)(n.code,{children:"validate"})," schema:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    env: c.string({\n      env: "NODE_ENV",\n      defaultValue: "development",\n      oneOf: ["development", "staging", "production"],\n    }),\n    logLevel: c.number({\n      env: "LOG_LEVEL",\n      defaultValue: 1,\n      oneOf: [0, 1, 2, 3],\n    }),\n  })\n  .load({ env: true, args: false });\n'})}),"\n",(0,t.jsxs)(n.p,{children:["If a value is not in the allowed set, a ",(0,t.jsx)(n.code,{children:"ConfigLoadError"})," is thrown with ",(0,t.jsx)(n.code,{children:'kind: "validation"'}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"type-narrowing",children:"Type Narrowing"}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"oneOf"})," is provided, the inferred type is automatically narrowed to the union of the allowed values:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const config = c\n  .schema({\n    env: c.string({ oneOf: ["dev", "staging", "prod"] }),\n  })\n  .load({ env: false, args: false });\n\n// config.env is typed as "dev" | "staging" | "prod", not string\n'})}),"\n",(0,t.jsxs)(n.p,{children:["When used with ",(0,t.jsx)(n.code,{children:"cli: true"}),", the ",(0,t.jsx)(n.code,{children:"--help"})," output automatically lists the allowed values."]}),"\n",(0,t.jsx)(n.h2,{id:"sensitive-fields",children:"Sensitive Fields"}),"\n",(0,t.jsxs)(n.p,{children:["Mark fields as ",(0,t.jsx)(n.code,{children:"sensitive: true"})," to prevent their values from being exposed in logs or debug output:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const schema = {\n  host: c.string({ defaultValue: "localhost" }),\n  apiKey: c.string({ env: "API_KEY", sensitive: true }),\n  db: c.object({\n    item: {\n      host: c.string({ defaultValue: "db.local" }),\n      password: c.string({ env: "DB_PASS", sensitive: true }),\n    },\n  }),\n};\n\nconst config = c.schema(schema).load({ env: true, args: false });\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Sensitive values load normally \u2014 ",(0,t.jsx)(n.code,{children:"config.apiKey"})," returns the real value. The flag only affects the masking utilities ",(0,t.jsx)(n.a,{href:"./loading-and-sources#printconfig",children:(0,t.jsx)(n.code,{children:"printConfig()"})})," and ",(0,t.jsx)(n.a,{href:"./loading-and-sources#masksecrets",children:(0,t.jsx)(n.code,{children:"maskSecrets()"})}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,t.jsxs)(n.p,{children:["Add per-field validation using the ",(0,t.jsx)(n.code,{children:"validate"})," option. config-loader accepts any ",(0,t.jsx)(n.a,{href:"https://github.com/standard-schema/standard-schema",children:"Standard Schema v1"})," implementation \u2014 including ",(0,t.jsx)(n.strong,{children:"Zod"}),", ",(0,t.jsx)(n.strong,{children:"Valibot"}),", and ",(0,t.jsx)(n.strong,{children:"ArkType"})," \u2014 or a custom validator."]}),"\n",(0,t.jsxs)(n.p,{children:["Validation runs ",(0,t.jsx)(n.strong,{children:"after"})," type coercion, so validators see the final typed value (e.g., the number ",(0,t.jsx)(n.code,{children:"3000"}),", not the string ",(0,t.jsx)(n.code,{children:'"3000"'})," from an env var)."]}),"\n",(0,t.jsx)(n.h3,{id:"with-zod",children:"With Zod"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import c from "@meltstudio/config-loader";\nimport { z } from "zod";\n\nconst config = c\n  .schema({\n    port: c.number({\n      required: true,\n      env: "PORT",\n      validate: z.number().min(1).max(65535),\n    }),\n    host: c.string({\n      required: true,\n      validate: z.string().url(),\n    }),\n    env: c.string({\n      defaultValue: "development",\n      validate: z.enum(["development", "staging", "production"]),\n    }),\n  })\n  .load({ env: true, args: false, files: "./config.yaml" });\n'})}),"\n",(0,t.jsx)(n.h3,{id:"with-a-custom-validator",children:"With a custom validator"}),"\n",(0,t.jsxs)(n.p,{children:["Any object with a ",(0,t.jsx)(n.code,{children:"~standard.validate()"})," method works:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const portValidator = {\n  "~standard": {\n    version: 1,\n    vendor: "my-app",\n    validate(value: unknown) {\n      if (typeof value === "number" && value >= 1 && value <= 65535) {\n        return { value };\n      }\n      return { issues: [{ message: "must be a valid port (1-65535)" }] };\n    },\n  },\n};\n\nc.number({ required: true, env: "PORT", validate: portValidator });\n'})}),"\n",(0,t.jsx)(n.h3,{id:"validation-pipeline",children:"Validation pipeline"}),"\n",(0,t.jsxs)(n.p,{children:["The full validation pipeline for each field is: ",(0,t.jsxs)(n.strong,{children:["resolve value \u2192 type coerce \u2192 ",(0,t.jsx)(n.code,{children:"oneOf"})," check \u2192 ",(0,t.jsx)(n.code,{children:"validate"})," schema"]}),". If ",(0,t.jsx)(n.code,{children:"oneOf"})," fails, ",(0,t.jsx)(n.code,{children:"validate"})," is skipped. If type coercion fails, both ",(0,t.jsx)(n.code,{children:"oneOf"})," and ",(0,t.jsx)(n.code,{children:"validate"})," are skipped."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},416(e,n,i){i.d(n,{R:()=>a,x:()=>c});var s=i(9471);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);